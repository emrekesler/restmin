<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Restmin Lightweight REST API Tool</title>
    <link rel="icon" type="image/x-icon" href="assets/lostman.ico" />
    <link href="css/styles.css" rel="stylesheet" />
</head>

<body class="sb-sidenav-toggled">
    <div class="d-flex overflow-visible" id="wrapper">
        <div class="bg-soft-dark" id="sidebar-wrapper">
            <div class="sidebar-heading border-bottom bg-soft-dark">
                <img src="assets/lostman.png">
                <div class=" text-center mt-2">Restmin
                </div>
            </div>
            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action list-group-item-dark p-3 disabled" href="#!">Home</a>
                <a class="list-group-item list-group-item-action list-group-item-dark p-3 disabled"
                    href="#!">Collections</a>
                <a class="list-group-item list-group-item-action list-group-item-dark p-3 disabled"
                    href="#!">History</a>
            </div>
        </div>
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-dark border-bottom">
                <div class="container-fluid">
                    <div class="header_toggle">
                        <span id="sidebarToggle" class="navbar-toggler-icon"></span>
                    </div>


                </div>
            </nav>
            <div class="container-fluid" id="app">
                <div class="row">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12">
                                <div class="input-group mb-3 mt-3">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                        data-bs-toggle="dropdown" aria-expanded="false">{{request.method}}</button>

                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" v-on:click="changeRequestMetod('GET')">GET</a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" v-on:click="changeRequestMetod('POST')">POST</a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" v-on:click="changeRequestMetod('PUT')">PUT</a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item"
                                                v-on:click="changeRequestMetod('DELETE')">DELETE</a>
                                        </li>
                                    </ul>
                                    <input type="text" class="form-control" placeholder="Enter request URL"
                                        v-model="request.url">
                                    <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                        v-on:click="sendRequest">Send</button>

                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <nav>
                                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab"
                                            data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                                            aria-selected="true">Headers</button>

                                        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab"
                                            data-bs-target="#nav-profile" type="button" role="tab"
                                            aria-controls="nav-profile" aria-selected="false">Body</button>
                                    </div>
                                </nav>

                                <div class="tab-content" id="nav-tabContent">
                                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                                        aria-labelledby="nav-home-tab">
                                        <div class="row">
                                            <div class="col-12">

                                                <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-2 mt-2">
                                                    <button class="btn btn-sm btn-primary" type="button"
                                                        v-on:click="addHeader('','')">Add New Header</button>

                                                    <button class="btn btn-sm btn-primary" type="button"
                                                        v-on:click="addHeader('Authorization','Bearer ')">Add Bearer
                                                        Header</button>

                                                    <button class="btn btn-sm btn-primary" type="button"
                                                        v-on:click="addHeader('Authorization','Basic ')">Add
                                                        Basic Header</button>
                                                </div>

                                                <table class="table table-dark table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col"></th>
                                                            <th scope="col">Key</th>
                                                            <th scope="col">Value</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr v-for="header in request.headers">
                                                            <th scope="row">
                                                                <input type="checkbox" class="form-check-input checkbox"
                                                                    v-model="header.checked">
                                                            </th>
                                                            <td>
                                                                <input type="text" class="form-control"
                                                                    v-model="header.key">
                                                            </td>
                                                            <td>
                                                                <input type="text" class="form-control"
                                                                    v-model="header.value">
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="nav-profile" role="tabpanel"
                                        aria-labelledby="nav-profile-tab">
                                        <div class="row mt-3 ">
                                            <div class="col-12">
                                                <label for="basic-url" class="form-label">Body Type</label>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="request.bodyType"
                                                        value="None" id="flexRadioDefault1" v-model="request.bodyType">

                                                    <label class="form-check-label" for="flexRadioDefault1">
                                                        None
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="request.bodyType"
                                                        value="Raw" v-model="request.bodyType" id="flexRadioDefault2">

                                                    <label class="form-check-label" for="flexRadioDefault2">
                                                        Raw
                                                    </label>
                                                </div>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="request.bodyType"
                                                        value="FormData" v-model="request.bodyType"
                                                        id="flexRadioDefault3" disabled>

                                                    <label class="form-check-label" for="flexRadioDefault3">
                                                        Form Data (Not Supported Yet)
                                                    </label>
                                                </div>

                                                <div class="row mt-3">
                                                    <div class="col-12">
                                                        <div class="form-floating">
                                                            <textarea class="form-control"
                                                                placeholder="Leave a comment here"
                                                                id="floatingTextarea2" style="height: 200px"
                                                                v-model="request.body"></textarea>
                                                            <label for="floatingTextarea2">Body</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div id="status" class="text-end">
                                    <span class="text-end">
                                        Status: <span>{{response.statusCode}}</span> -
                                        Time: <span>{{response.elapsedTime}}</span> -
                                        Size: <span>{{response.size}}</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <div id="container" class="mt-3" style="height:50vh"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="js/scripts.js"></script>

<script>

    const vueApp = vue.createApp({
        data() {
            return {
                request: {
                    url: "https://jsonplaceholder.typicode.com/posts",
                    method: "GET",
                    body: "",
                    bodyType: "None",
                    headers: [],
                },
                response: {
                    statusCode: "",
                    elapsedTime: "",
                    size: ""
                }
            }
        },
        methods: {
            changeRequestMetod(method) {
                this.request.method = method;
            },
            addHeader(key = "", value = "") {
                this.request.headers.push({
                    checked: true,
                    key: key,
                    value: value
                });
            },
            sendRequest() {

                var activeHeaders = this.request.headers.filter((item) => { return item.checked === true });

                var config = {
                    method: this.request.method,
                    url: this.request.url,
                    transformResponse: (res) => {
                        // Do your own parsing here if needed ie JSON.parse(res);
                        return res;
                    },
                };

                if (activeHeaders.length > 0) {
                    config.headers = activeHeaders.reduce(function (map, obj) {
                        map[obj.key] = obj.value;
                        return map;
                    }, {});;
                }

                if (this.request.bodyType != "None") {
                    if (this.request.body.length > 0) {
                        config.data = JSON.stringify(JSON.parse(this.request.body));
                    }
                }

                axios(config).then(response => {
                    setEditor(response);
                }).catch(error => {

                    if (error.response) {
                        setEditor(error.response);
                        return;
                    }

                    editor.getModel().setValue("Could not send request");
                    vueApp.response.statusCode = error;
                    vueApp.response.elapsedTime = 0;
                    vueApp.response.size = 0;
                });

            }
        }
    }).mount("#app");

    function setEditor(response) {

        let lang = getMonacoLang(response.headers["content-type"]);
        let editorModel = editor.getModel();
        monaco.editor.setModelLanguage(editorModel, lang)
        editorModel.setValue(response.data);

        vueApp.response.statusCode = response.status;
        vueApp.response.elapsedTime = `${new Date().getTime() - response.config.meta.requestStartedAt} ms`;
        vueApp.response.size = humanFileSize(JSON.stringify(response.data).length);

        setTimeout(function () {
            editor.getAction('editor.action.formatDocument').run();
        }, 100);

    }

</script>


</html>